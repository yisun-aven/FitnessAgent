# FitnessAgent

A minimal MVP health/fitness agentic app:
- iOS frontend (SwiftUI, iOS 16+)
- Python FastAPI backend
- Supabase for authentication (email + Google planned) and database
- Early agent graph (LangGraph planned), Google Calendar integration planned
- HealthKit read-only (no watch app in MVP)

Repo: https://github.com/yisun-aven/FitnessAgent

## Project Structure
```
FitnessAgent/               # iOS app (SwiftUI)
backend/                    # FastAPI backend
infra/                      # Supabase schema/policies
```

## Features (MVP)
- Login/Sign up UI with polished SwiftUI design
- Auth with Supabase JWT; iOS passes Bearer token to backend
- Goals and Tasks APIs
  - POST /tasks/generate returns draft tasks (client chooses which to save)
  - POST /tasks persists a task
- In-memory per-user storage in backend (temporary for MVP)

## Prerequisites
- Xcode 15+, iOS 16+
- Python 3.11+
- A Supabase project (URL and anon key)

---

## iOS App Setup
1) Open the project:
```
open FitnessAgent/FitnessAgent.xcodeproj
```
2) Configure API base URL and Supabase values in the app configuration file(s) (see `FitnessAgent/Services/Config.swift` and `APIClient.swift`). Ensure:
- API_BASE_URL points to your backend (e.g. http://localhost:8000)
- Supabase URL and anon key are set in your app config if referenced

3) Build and run on simulator or device (iOS 16+).

4) Auth flow
- On successful login/signup with Supabase, the app stores the current session token and attaches it to API requests as `Authorization: Bearer <token>`.
- On logout, the token is cleared. Ensure no stale tokens are retained between accounts.

---

## Backend Setup (FastAPI)
1) Create env file:
```
cd backend
cp .env.example .env
# Edit .env with your Supabase project values
```
Important keys in `.env`:
```
APP_ENV=local
APP_HOST=0.0.0.0
APP_PORT=8000
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=YOUR_ANON_KEY
```

2) Create a virtualenv and install deps:
```
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

3) Run the API:
```
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```
The app loads `.env` early to ensure Supabase keys are available for auth.

---

## API Overview
Base URL: `http://localhost:8000`

- Auth: All protected routes require header:
```
Authorization: Bearer <SUPABASE_JWT>
```

- Goals:
  - `GET /goals` — list goals for current user
  - `POST /goals` — create a goal

- Tasks:
  - `GET /tasks` — list tasks for current user
  - `POST /tasks` — create/persist a task
  - `POST /tasks/generate` — generate draft tasks (not persisted)

- Schedule:
  - `GET /schedule` — sample placeholder (if enabled)

Notes:
- The backend stores data in memory keyed by the Supabase user id for MVP. Replace with persistent storage for production.
- Consider adding `/me` to quickly verify the current authenticated user.

---

## Security & Environment
- Do NOT commit real secrets. `.env` is ignored by git.
- `.env.example` documents required variables. Replace real values with placeholders if sharing publicly.
- Supabase anon keys are public by design, but rotating keys and using RLS policies is recommended.

---

## Development Tips
- If you change auth or tokens in the app, ensure `APIClient` refreshes the Authorization header after login and clears it on logout to prevent user data bleed.
- If you see 307 redirects on FastAPI routes, ensure route decorators don’t have leading slashes when using a prefixed router and `include_router(prefix=...)`.
- CORS: Adjust settings in `backend/app/main.py` if calling from a device or a different origin.

---

## Roadmap
- Replace in-memory storage with persistent DB (Supabase/Postgres tables)
- Apple Sign In button (post-MVP)
- Google Calendar integration
- Agent graph with LangGraph
- HealthKit read-only integrations

---

## Contributing
1) Clone and create a branch:
```
git clone https://github.com/yisun-aven/FitnessAgent.git
cd FitnessAgent
git checkout -b feature/your-change
```
2) Keep secrets out of commits. Use `.env` locally and update `backend/.env.example` for new variables.
3) Use conventional commits where possible.
4) PRs to `main` with a clear description and testing notes.

Repo hygiene:
- `.history/` should be ignored. If already tracked:
```
echo "\n.history/" >> .gitignore
git rm -r --cached .history
git add .gitignore
git commit -m "Stop tracking .history"
```

---

## License
MIT (add LICENSE file if needed)
